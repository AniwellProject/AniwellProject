<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="stylesheet" th:href="@{/resource/css/main.css}">
	<link rel="stylesheet" th:href="@{/resource/css/dog-toggle.css}" />
	<link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">

	<title>MAIN</title>
</head>

<body class="bg-gradient-to-b from-[#E4F0B9] to-[#FCDCA9]">
	<div class="section section-top mx-auto z-0">
		<img class="logo mx-auto" src="https://imgur.com/rcOcaL6.png" alt="d">
		<div class="bg-logo">
			<img class="b-logo mx-auto" src="https://imgur.com/qYhSSXR.png"  alt="aniwell_큰_로고">
			<div class="char">
				<img class="img_head sway-top" src="/img/logo_head.PNG" alt="dog_cat">
				<img class="img_body w-full mx-auto absolute" src="/img/logo-body.png" alt="dog_cat">
			</div>
			<div class="scroll-indicator absolute w-full mx-auto z-10 mt-52">
				<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64"
					class="mx-auto animate-bounce-down">
					<circle cx="32" cy="32" r="30" stroke="#ffffffaa" stroke-width="2" fill="none" />
					<line x1="32" y1="20" x2="32" y2="40" stroke="#ffffff" stroke-width="3" stroke-linecap="round" />
					<polyline points="24,34 32,42 40,34" fill="none" stroke="#ffffff" stroke-width="3"
						stroke-linecap="round" stroke-linejoin="round" />
				</svg>
			</div>

			<div class="icon z-10">
				<!-- 로그인 버튼 -->
				<button type="button" class="" th:if="${!rq.isLogined}"
									onclick="setTimeout(() => { location.href='/usr/member/login'; }, 1000)">
					<div class="toggle dog-rollover">
						<input type="checkbox" id="doggo">
						<label for="doggo" class="toggle-item">
							<div class="dog">
								<div class="ear"></div>
								<div class="ear right"></div>
								<div class="face">
									<div class="eyes"></div>
									<div class="mouth"></div>
								</div>
							</div>
						</label>
					</div>
				</button>

				<div class="up-icon z-10">
					<button id="vetList" type="button" class="in-icon hidden">
						vetlist
						<img src="https://i.imgur.com/2ZJPrGR.png" alt="vetlist">
					</button>
					<button id="petlist" type="button" class="in-icon hidden">
						petlist
						<img src="https://i.imgur.com/2ZJPrGR.png" alt="petlist">
					</button>
				</div>
			</div>
		</div>

	</div>

	<!-- 중간 섹션 -->
	<div id="sectionMiddle" class="z-10 section-middle mx-auto transition-all duration-700">

		

		<!-- 🐾 세션 2 -->
		<section id="sec2" class="flex items-center min-h-[100dvh] md:min-h-screen w-full bg-gradient-to-b from-[#fff7e6] to-[#ffe4b3]">
			<!-- 🌊 파도 배경 -->
					<div class="wave"></div>
			<div class="mx-auto grid md:grid-cols-2 items-center gap-6 md:gap-10 px-6 md:px-16 py-32">
				<!-- 왼쪽: 문구 -->
				<div class="max-w-2xl" data-aos="fade-right">
					<h2 class="text-5xl font-extrabold text-[#2b2b2b] drop-shadow mb-4">
						우리 아이의 하루,<br>발자국까지 기록합니다 🐾
					</h2>
					<p class="text-lg text-gray-700 leading-relaxed">
						배변 횟수와 움직임을 분석해<br>어디에서 얼마나 머물렀는지 알려드려요.
					</p>
				</div>

				<!-- 오른쪽: 애니메이션 요소 -->
				<div class="relative h-[40vh] md:h-[60vh] overflow-visible">
					<!-- 원하는 이미지/SVG/Lottie로 교체 가능 -->
					<img src="/img/default-pet.png" alt="paw"
						class="right-anim absolute right-0 bottom-0 w-[55%] max-w-[420px]" />
				</div>
			</div>
		</section>

		<!-- 📸 세션 3 -->
		<!-- 섹션 3 : 핀 고정 애니메이션 -->
		<section id="sec3" class="min-h-[100dvh] md:min-h-screen w-full bg-gradient-to-b from-[#e0f7fa] to-[#b2ebf2]">
			<div class="mx-auto grid md:grid-cols-2 items-center gap-6 md:gap-10 px-6 md:px-16 py-16">
				<!-- 왼쪽: 문구 -->
				<div class="max-w-2xl">
					<h2 class="text-5xl font-extrabold text-cyan-900 drop-shadow mb-4">
						한 장의 사진으로 마음을 읽어요 💖
					</h2>
					<p class="text-lg text-gray-700 leading-relaxed">
						반려동물의 표정과 행동 패턴을 분석해<br>행복, 즐거움, 피곤함까지 알려드립니다.
					</p>
				</div>

				<!-- 오른쪽: 여러 레이어를 순차 애니메이션 -->
				<div class="relative h-[45vh] md:h-[65vh]">
					<img src="/img/emo-cat.png" class="sec3-layer absolute right-0 bottom-0 w-[70%] max-w-[480px]" />
					<img src="/img/emo-cat.png" class="sec3-dog absolute right-[10%] bottom-[8%] w-[42%] opacity-0" />
					<img src="/img/emo-cat.png" class="sec3-heart absolute right-[40%] top-[10%] w-[12%] opacity-0" />
					<img src="/img/emo-cat.png" class="sec3-sparkle absolute right-[22%] top-[4%] w-[10%] opacity-0" />
				</div>
			</div>
		</section>


	</div>



	<!-- AOS 라이브러리 불러오기-->
	<link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
	<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
	<script>
		AOS.init();
	</script>

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		if (![[${rq.isLogined}]]) {
			// 로그인 상태가 아니라면 localStorage 정리
			localStorage.removeItem("loginedMember");
			localStorage.removeItem("selectedPetId");
		}
	</script>
	<!-- JS -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/ScrollTrigger.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/ScrollToPlugin.min.js"></script>

	<script>
		document.addEventListener('DOMContentLoaded', () => {
			AOS.init({once: true, duration: 600, easing: 'ease-out'});
		});
	</script>
	<script>

		const isLogined = localStorage.getItem("loginedMember") !== null;

		if (!isLogined) {
			localStorage.removeItem("loginedMember");
			localStorage.removeItem("selectedPetId");
			return;
		}

		document.getElementById("loginButton").classList.add("hidden");
		if (!memberId) return;

		$.get("/api/member/getUsrInfo", {memberId})
			.done(function (data) {
				const authLevel = data.authLevel;
				if (authLevel === 3) {
					$("#vetList").removeClass("hidden").on("click", () => {
						location.href = "/usr/vetAnswer/vetList";
					});
				} else {
					$("#petlist").removeClass("hidden").on("click", () => {
						location.href = `/usr/pet/list?memberId=${memberId}`;
					});
				}
			})
			.fail((err) => console.error("getUsrInfo 실패", err));

		// 로그인 버튼 클릭 시
		document.getElementById("loginButton").addEventListener("click", () => {
			setTimeout(() => {
				location.href = "/usr/member/login";
			}, 1000);
		});
	</script>

	<script>
		gsap.registerPlugin(ScrollTrigger);

		// section-top의 하단이 뷰포트 하단에 닿는 지점부터 200px 스크롤 구간 동안
		// #sectionMiddle의 margin-top을 0 -> -80px로 보간
		gsap.to("#sectionMiddle", {
			marginTop: -80,
			ease: "none",
			scrollTrigger: {
				trigger: ".section-top",
				start: "bottom bottom", // section-top의 bottom이 뷰포트 bottom과 만날 때 시작
				end: "+=200",           // 200px 스크롤 동안 변화 (체감에 맞게 120~300 사이로 조절)
				scrub: true             // 스크롤 연동
				// markers: true         // 디버그용
			}
		});

		// 중간 섹션 안 요소들 페이드업(옵션)
		gsap.utils.toArray('#sectionMiddle .animate-content').forEach((el, i) => {
			gsap.fromTo(el,
				{opacity: 0, y: 24},
				{
					opacity: 1, y: 0, duration: 0.6, delay: i * 0.08,
					scrollTrigger: {trigger: el, start: "top 80%"}
				}
			);
		});
	</script>

	<script>


		// 오른쪽 패럴랙스 (세션2)
		gsap.fromTo(".right-anim",
			{y: 80, opacity: 0, rotate: -4, scale: 0.96},
			{
				y: -40, opacity: 1, rotate: 0, scale: 1,
				ease: "power2.out",
				scrollTrigger: {
					pinSpacing: true, 
					trigger: "#sec2",             // ✅ 섹션 자체를 트리거
					start: "top bottom",          // 섹션 top이 뷰포트 bottom에 닿을 때 시작
					end: "bottom top",            // 섹션 bottom이 뷰포트 top에 닿을 때 끝
					scrub: true
				}
			}
		);


		const tl3 = gsap.timeline({
		  scrollTrigger: {
		    trigger: "#sec3",                // 세션 루트
		    start: "top  top",                // 세션 시작과 동시에
		    end: () => "+=" + window.innerHeight * 2, // 2뷰포트 길이 만큼 진행
		    scrub: true,
		    pin: true,             // ✅ 자식만 고정
		    pinSpacing: true,               // ✅ pinSpacer 생성 안 함 (부모 레이아웃 안 흔들림)
		    anticipatePin: 1,
		    invalidateOnRefresh: true,
		    markers: true,
			id: "sec3", 
		  }
		});
		tl3.fromTo(".sec3-layer",
			{y: 40, scale: 0.92, rotate: -2, opacity: 0},
			{y: 0, scale: 1, rotate: 0, opacity: 1, duration: 0.35, ease: "power2.out"}
		).to(".sec3-dog", {opacity: 1, y: -10, duration: 0.25, ease: "power2.out"}, ">-0.05")
			.to(".sec3-heart", {opacity: 1, y: -20, scale: 1.1, duration: 0.2, ease: "back.out(2)"}, "+=0.05")
			.to(".sec3-sparkle", {opacity: 1, y: -16, scale: 1.08, duration: 0.2, ease: "back.out(2)"}, "<0.05")
			.to([".sec3-layer", ".sec3-dog", ".sec3-heart", ".sec3-sparkle"],
				{y: -30, duration: 0.4, ease: "none"});

	</script>



	<script>

		let memberId = null;
		function ee() {
			$.ajax({
				type: "GET",
				url: `/api/member/myPage`,
				success: function (data) {
					console.log(data.id);
					memberId = data.id;
					localStorage.setItem("loginedMember", memberId);
					e();
				},
				error: function (err) {
					console.error("가져오기실패", err);
				}
			});
		}
		let authLevel = null;
		function e() {
			$.ajax({
				type: "GET",
				url: `/api/member/getUsrInfo`,
				data: {memberId: memberId},
				success: function (data) {
					authLevel = data.authLevel;
					if (authLevel === 3) {
						// 수의사 버튼만 보여주기
						$("#vetList").removeClass("hidden").on("click", function () {
							location.href = "/usr/vetAnswer/vetList";
						});
					} else {
						// 일반 사용자 버튼만 보여주기
						$("#petlist").removeClass("hidden").on("click", function () {
							location.href = `/usr/pet/list?memberId=${memberId}`;
						});
					}
				},
				error: function (err) {
					console.error("getUsrInfo 실패", err);
				}
			});
		}

		ee();
	</script>


</body>

</html>